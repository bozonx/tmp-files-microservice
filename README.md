# –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (NestJS + Fastify)

REST-—Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Å TTL, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π –∏ –ø–ª–∞–Ω–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–æ–π. –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ NestJS + Fastify.

## –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ

- üè• –ü—Ä–æ—Å—Ç–æ–π health-check —ç–Ω–¥–ø–æ–∏–Ω—Ç `/{API_BASE_PATH}/{API_VERSION}/health`
- üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Pino (JSON –≤ prod)
- üõ°Ô∏è –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –æ—à–∏–±–æ–∫
- ‚ö° Fastify
- üß™ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Jest-—Ç–µ—Å—Ç—ã (unit –∏ e2e)
- üê≥ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ –≤ Docker
- üö´ –ë–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏; Swagger –∏ GraphQL –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API Gateway)

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ REST (`multipart/form-data`), —Ö—Ä–∞–Ω–∏—Ç –∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (TTL –≤ —Å–µ–∫—É–Ω–¥–∞—Ö), –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Å–∫–∞—á–∏–≤–∞–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ SHA-256 –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `ttl` (—Å–µ–∫—É–Ω–¥—ã) –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö `metadata` (JSON)
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ —Ö—ç—à—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (MIME, —Ä–∞–∑–º–µ—Ä, –¥–∞—Ç—ã), –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∏ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—Å—Ä–æ—á–∫–∏
- –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞: `GET /{API_BASE_PATH}/{API_VERSION}/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ status: "ok" }`

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- Node.js 22+
- pnpm 10+

```bash
# 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# 2) –û–∫—Ä—É–∂–µ–Ω–∏–µ (prod)
cp env.production.example .env.production

# 3) –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (prod)
pnpm build
pnpm start:prod
```

URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (prod): `http://localhost:80/api/v1`
–î–ª—è Docker Compose: `http://localhost:8080/api/v1`

–ü–æ–¥—Ä–æ–±–Ω–æ: `docs/quick-start.md`.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–§–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `.env.production`
- `.env` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö: `.env.production.example`.

–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `NODE_ENV` ‚Äî `production|development|test`
- `LISTEN_HOST` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, `0.0.0.0` –∏–ª–∏ `localhost`
- `LISTEN_PORT` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, `80` –∏–ª–∏ `3000`
- `API_BASE_PATH` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `api`)
- `API_VERSION` ‚Äî –≤–µ—Ä—Å–∏—è API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `v1`)
- `LOG_LEVEL` ‚Äî `trace|debug|info|warn|error|fatal|silent`
- `TZ` ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `UTC`)
- `SERVICE_NAME` ‚Äî –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ª–æ–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `tmp-files-microservice`)

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `GET /{API_BASE_PATH}/{API_VERSION}/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `POST /{API_BASE_PATH}/{API_VERSION}/files` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (multipart/form-data)
  - –ü–æ–ª—è: `file` (binary), `ttl` (integer, —Å–µ–∫—É–Ω–¥—ã), `metadata` (string, JSON, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), `allowDuplicate` (`true|false`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ), `customFilename` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `GET /{API_BASE_PATH}/{API_VERSION}/files/:id` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
  - Query: `includeExpired=true|false`
- `GET /{API_BASE_PATH}/{API_VERSION}/files/:id/download` ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
  - Query: `includeExpired=true|false`
- `DELETE /{API_BASE_PATH}/{API_VERSION}/files/:id` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
  - Query: `force=true|false`
- `GET /{API_BASE_PATH}/{API_VERSION}/files` ‚Äî –ø–æ–∏—Å–∫/–ª–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤
  - Query: `mimeType`, `minSize`, `maxSize`, `uploadedAfter`, `uploadedBefore`, `expiredOnly`, `limit`, `offset`
- `GET /{API_BASE_PATH}/{API_VERSION}/files/stats` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /{API_BASE_PATH}/{API_VERSION}/files/:id/exists` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
  - Query: `includeExpired=true|false`

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: `docs/api-specification.md`

## –ü—Ä–∏–º–µ—Ä—ã (cURL)

–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):

```bash
curl -X POST \
  -F "file=@./README.md" \
  -F "ttl=3600" \
  http://localhost:3000/api/v1/files | jq
```

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:

```bash
FILE_ID="<uuid>"
curl -s http://localhost:3000/api/v1/files/$FILE_ID | jq
```

–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞:

```bash
curl -L -o downloaded.bin http://localhost:3000/api/v1/files/$FILE_ID/download
```

–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞:

```bash
curl -s -X DELETE http://localhost:3000/api/v1/files/$FILE_ID | jq
```

–ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤: `docs/usage-examples.md`.

## –¢–µ—Å—Ç—ã
–°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `docs/dev.md`.

## Docker

- Dockerfile –æ–∂–∏–¥–∞–µ—Ç —É–∂–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–π `dist/`
- –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ ‚Äî `docker/docker-compose.yml`

```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pnpm build

# –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ compose (–±–µ–∑ cd)
docker compose -f docker/docker-compose.yml up -d --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (compose): `http://localhost:8080/api/v1/health`

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `docs/quick-start.md` ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `docs/api-specification.md` ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è REST API (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `docs/usage-examples.md` ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã cURL
- `dev_docs/STORAGE_MODULE.md` ‚Äî –¥–µ—Ç–∞–ª–∏ –º–æ–¥—É–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- `docs/dev.md` ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- `docs/CHANGELOG.md` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
